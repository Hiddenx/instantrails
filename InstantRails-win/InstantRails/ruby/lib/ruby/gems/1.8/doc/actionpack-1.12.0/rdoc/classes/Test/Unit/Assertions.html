<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: Test::Unit::Assertions</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">Test::Unit::Assertions</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/action_controller/assertions_rb.html">
                lib/action_controller/assertions.rb
                </a>
        <br />
                <a href="../../../files/lib/action_controller/deprecated_assertions_rb.html">
                lib/action_controller/deprecated_assertions.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
In addition to these specific assertions, you also have easy access to
various collections that the regular test/unit assertions can be used
against. These collections are:
</p>
<ul>
<li>assigns: Instance variables assigned in the action that are available for
the view.

</li>
<li>session: Objects being saved in the session.

</li>
<li>flash: The flash objects currently in the session.

</li>
<li>cookies: Cookies being sent to the user on this request.

</li>
</ul>
<p>
These collections can be used just like any other hash:
</p>
<pre>
  assert_not_nil assigns(:person) # makes sure that a @person instance variable was set
  assert_equal &quot;Dave&quot;, cookies[:name] # makes sure that a cookie called :name was set as &quot;Dave&quot;
  assert flash.empty? # makes sure that there's nothing in the flash
</pre>
<p>
For historic reasons, the assigns hash uses string-based keys. So
assigns[:person] won&#8217;t work, but assigns[&quot;person&quot;] will. To
appease our yearning for symbols, though, an alternative accessor has been
deviced using a method call instead of index referencing. So
assigns(:person) will work just like assigns[&quot;person&quot;], but
again, assigns[:person] will not work.
</p>
<p>
On top of the collections, you have the complete url that a given action
redirected to available in redirect_to_url.
</p>
<p>
For redirects within the same controller, you can even call follow_redirect
and the redirect will be followed, triggering another action call which can
then be asserted against.
</p>
<h2>Manipulating the request collections</h2>
<p>
The collections described above link to the response, so you can test if
what the actions were expected to do happened. But sometimes you also want
to manipulate these collections in the incoming request. This is really
only relevant for sessions and cookies, though. For sessions, you just do:
</p>
<pre>
  @request.session[:key] = &quot;value&quot;
</pre>
<p>
For cookies, you need to manually create the cookie, like this:
</p>
<pre>
  @request.cookies[&quot;key&quot;] = CGI::Cookie.new(&quot;key&quot;, &quot;value&quot;)
</pre>
<h2>Testing named routes</h2>
<p>
If you&#8217;re using named routes, they can be easily tested using the
original named routes methods straight in the test case. Example:
</p>
<pre>
 assert_redirected_to page_url(:title =&gt; 'foo')
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001064">assert_dom_equal</a>&nbsp;&nbsp;
      <a href="#M001065">assert_dom_not_equal</a>&nbsp;&nbsp;
      <a href="#M001060">assert_generates</a>&nbsp;&nbsp;
      <a href="#M001063">assert_no_tag</a>&nbsp;&nbsp;
      <a href="#M001059">assert_recognizes</a>&nbsp;&nbsp;
      <a href="#M001057">assert_redirected_to</a>&nbsp;&nbsp;
      <a href="#M001056">assert_response</a>&nbsp;&nbsp;
      <a href="#M001061">assert_routing</a>&nbsp;&nbsp;
      <a href="#M001062">assert_tag</a>&nbsp;&nbsp;
      <a href="#M001058">assert_template</a>&nbsp;&nbsp;
      <a href="#M001066">assert_valid</a>&nbsp;&nbsp;
      <a href="#M001067">clean_backtrace</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">



    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">assert_template_equal</td>
          <td>-></td>
          <td class="context-item-value">assert_assigned_equal</td>
        </tr>
                        </table>
      </div>
    </div>


      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001064" class="method-detail">
        <a name="M001064"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001064.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001064.html');return false;">
          <span class="method-name">assert_dom_equal</span><span class="method-args">(expected, actual, message=&quot;&quot;)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
test 2 html strings to be equivalent, i.e. identical up to reordering of
attributes
</p>
        </div>
      </div>

      <div id="method-M001065" class="method-detail">
        <a name="M001065"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001065.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001065.html');return false;">
          <span class="method-name">assert_dom_not_equal</span><span class="method-args">(expected, actual, message=&quot;&quot;)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
negated form of <tt>assert_dom_equivalent</tt>
</p>
        </div>
      </div>

      <div id="method-M001060" class="method-detail">
        <a name="M001060"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001060.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001060.html');return false;">
          <span class="method-name">assert_generates</span><span class="method-args">(expected_path, options, defaults={}, extras = {}, message=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that the provided options can be used to generate the provided
path.
</p>
        </div>
      </div>

      <div id="method-M001063" class="method-detail">
        <a name="M001063"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001063.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001063.html');return false;">
          <span class="method-name">assert_no_tag</span><span class="method-args">(*opts)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Identical to <a href="Assertions.html#M001062">assert_tag</a>, but asserts
that a matching tag does <em>not</em> exist. (See <a
href="Assertions.html#M001062">assert_tag</a> for a full discussion of the
syntax.)
</p>
        </div>
      </div>

      <div id="method-M001059" class="method-detail">
        <a name="M001059"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001059.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001059.html');return false;">
          <span class="method-name">assert_recognizes</span><span class="method-args">(expected_options, path, extras={}, message=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that the routing of the given path was handled correctly and that
the parsed options match.
</p>
        </div>
      </div>

      <div id="method-M001057" class="method-detail">
        <a name="M001057"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001057.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001057.html');return false;">
          <span class="method-name">assert_redirected_to</span><span class="method-args">(options = {}, message=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Assert that the redirection options passed in match those of the redirect
called in the latest action. This match can be partial, such that <a
href="Assertions.html#M001057">assert_redirected_to</a>(:controller =&gt;
&quot;weblog&quot;) will also match the redirection of
redirect_to(:controller =&gt; &quot;weblog&quot;, :action =&gt;
&quot;show&quot;) and so on.
</p>
        </div>
      </div>

      <div id="method-M001056" class="method-detail">
        <a name="M001056"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001056.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001056.html');return false;">
          <span class="method-name">assert_response</span><span class="method-args">(type, message = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that the response is one of the following types:
</p>
<ul>
<li><tt>:success</tt>: Status code was 200

</li>
<li><tt>:redirect</tt>: Status code was in the 300-399 range

</li>
<li><tt>:missing</tt>: Status code was 404

</li>
<li><tt>:error</tt>: Status code was in the 500-599 range

</li>
</ul>
<p>
You can also pass an explicit status code number as the type, like <a
href="Assertions.html#M001056">assert_response</a>(501)
</p>
        </div>
      </div>

      <div id="method-M001061" class="method-detail">
        <a name="M001061"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001061.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001061.html');return false;">
          <span class="method-name">assert_routing</span><span class="method-args">(path, options, defaults={}, extras={}, message=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that path and options match both ways; in other words, the URL
generated from options is the same as path, and also that the options
recognized from path are the same as options
</p>
        </div>
      </div>

      <div id="method-M001062" class="method-detail">
        <a name="M001062"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001062.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001062.html');return false;">
          <span class="method-name">assert_tag</span><span class="method-args">(*opts)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that there is a tag/node/element in the body of the response that
meets all of the given conditions. The <tt>conditions</tt> parameter must
be a hash of any of the following keys (all are optional):
</p>
<ul>
<li><tt>:tag</tt>: the node type must match the corresponding value

</li>
<li><tt>:attributes</tt>: a hash. The node&#8217;s attributes must match the
corresponding values in the hash.

</li>
<li><tt>:parent</tt>: a hash. The node&#8217;s parent must match the
corresponding hash.

</li>
<li><tt>:child</tt>: a hash. At least one of the node&#8217;s immediate
children must meet the criteria described by the hash.

</li>
<li><tt>:ancestor</tt>: a hash. At least one of the node&#8217;s ancestors must
meet the criteria described by the hash.

</li>
<li><tt>:descendant</tt>: a hash. At least one of the node&#8217;s descendants
must meet the criteria described by the hash.

</li>
<li><tt>:sibling</tt>: a hash. At least one of the node&#8217;s siblings must
meet the criteria described by the hash.

</li>
<li><tt>:after</tt>: a hash. The node must be after any sibling meeting the
criteria described by the hash, and at least one sibling must match.

</li>
<li><tt>:before</tt>: a hash. The node must be before any sibling meeting the
criteria described by the hash, and at least one sibling must match.

</li>
<li><tt>:children</tt>: a hash, for counting children of a node. Accepts the
keys:

<ul>
<li><tt>:count</tt>: either a number or a range which must equal (or include)
the number of children that match.

</li>
<li><tt>:less_than</tt>: the number of matching children must be less than this
number.

</li>
<li><tt>:greater_than</tt>: the number of matching children must be greater
than this number.

</li>
<li><tt>:only</tt>: another hash consisting of the keys to use to match on the
children, and only matching children will be counted.

</li>
</ul>
</li>
<li><tt>:content</tt>: the textual content of the node must match the

<pre>
  given value. This will not match HTML tags in the body of a
  tag--only text.
</pre>
</li>
</ul>
<p>
Conditions are matched using the following algorithm:
</p>
<ul>
<li>if the condition is a string, it must be a substring of the value.

</li>
<li>if the condition is a regexp, it must match the value.

</li>
<li>if the condition is a number, the value must match number.to_s.

</li>
<li>if the condition is <tt>true</tt>, the value must not be <tt>nil</tt>.

</li>
<li>if the condition is <tt>false</tt> or <tt>nil</tt>, the value must be
<tt>nil</tt>.

</li>
</ul>
<p>
Usage:
</p>
<pre>
  # assert that there is a &quot;span&quot; tag
  assert_tag :tag =&gt; &quot;span&quot;

  # assert that there is a &quot;span&quot; tag with id=&quot;x&quot;
  assert_tag :tag =&gt; &quot;span&quot;, :attributes =&gt; { :id =&gt; &quot;x&quot; }

  # assert that there is a &quot;span&quot; tag using the short-hand
  assert_tag :span

  # assert that there is a &quot;span&quot; tag with id=&quot;x&quot; using the short-hand
  assert_tag :span, :attributes =&gt; { :id =&gt; &quot;x&quot; }

  # assert that there is a &quot;span&quot; inside of a &quot;div&quot;
  assert_tag :tag =&gt; &quot;span&quot;, :parent =&gt; { :tag =&gt; &quot;div&quot; }

  # assert that there is a &quot;span&quot; somewhere inside a table
  assert_tag :tag =&gt; &quot;span&quot;, :ancestor =&gt; { :tag =&gt; &quot;table&quot; }

  # assert that there is a &quot;span&quot; with at least one &quot;em&quot; child
  assert_tag :tag =&gt; &quot;span&quot;, :child =&gt; { :tag =&gt; &quot;em&quot; }

  # assert that there is a &quot;span&quot; containing a (possibly nested)
  # &quot;strong&quot; tag.
  assert_tag :tag =&gt; &quot;span&quot;, :descendant =&gt; { :tag =&gt; &quot;strong&quot; }

  # assert that there is a &quot;span&quot; containing between 2 and 4 &quot;em&quot; tags
  # as immediate children
  assert_tag :tag =&gt; &quot;span&quot;,
             :children =&gt; { :count =&gt; 2..4, :only =&gt; { :tag =&gt; &quot;em&quot; } }

  # get funky: assert that there is a &quot;div&quot;, with an &quot;ul&quot; ancestor
  # and an &quot;li&quot; parent (with &quot;class&quot; = &quot;enum&quot;), and containing a
  # &quot;span&quot; descendant that contains text matching /hello world/
  assert_tag :tag =&gt; &quot;div&quot;,
             :ancestor =&gt; { :tag =&gt; &quot;ul&quot; },
             :parent =&gt; { :tag =&gt; &quot;li&quot;,
                          :attributes =&gt; { :class =&gt; &quot;enum&quot; } },
             :descendant =&gt; { :tag =&gt; &quot;span&quot;,
                              :child =&gt; /hello world/ }
</pre>
<p>
&lt;strong&gt;Please note&lt;/strong: <a
href="Assertions.html#M001062">assert_tag</a> and <a
href="Assertions.html#M001063">assert_no_tag</a> only work with well-formed
XHTML. They recognize a few tags as implicitly self-closing (like br and hr
and such) but will not work correctly with tags that allow optional closing
tags (p, li, td). <em>You must explicitly close all of your tags to use
these assertions.</em>
</p>
        </div>
      </div>

      <div id="method-M001058" class="method-detail">
        <a name="M001058"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001058.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001058.html');return false;">
          <span class="method-name">assert_template</span><span class="method-args">(expected = nil, message=nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Asserts that the request was rendered with the appropriate template file.
</p>
        </div>
      </div>

      <div id="method-M001066" class="method-detail">
        <a name="M001066"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001066.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001066.html');return false;">
          <span class="method-name">assert_valid</span><span class="method-args">(record)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
ensures that the passed record is valid by active record standards. returns
the error messages if not
</p>
        </div>
      </div>

      <div id="method-M001067" class="method-detail">
        <a name="M001067"></a>

        <div class="method-heading">
          <a href="Assertions.src/M001067.html" target="Code" class="method-signature"
            onclick="popupCode('Assertions.src/M001067.html');return false;">
          <span class="method-name">clean_backtrace</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>