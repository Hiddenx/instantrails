<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Mongrel::HttpServer</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Mongrel::HttpServer</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/mongrel_rb.html">
                lib/mongrel.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This is the main driver of <a href="../Mongrel.html">Mongrel</a>, while the
Mognrel::HttpParser and <a
href="URIClassifier.html">Mongrel::URIClassifier</a> make up the majority
of how the server functions. It&#8217;s a very simple class that just has a
thread accepting connections and a simple <a
href="HttpServer.html#M000036">HttpServer.process_client</a> function to do
the heavy lifting with the IO and Ruby.
</p>
<p>
You use it by doing the following:
</p>
<pre>
  server = HttpServer.new(&quot;0.0.0.0&quot;, 3000)
  server.register(&quot;/stuff&quot;, MyNifterHandler.new)
  server.run.join
</pre>
<p>
The last line can be just server.run if you don&#8217;t want to join the
thread used. If you don&#8217;t though Ruby will mysteriously just exit on
you.
</p>
<p>
Ruby&#8217;s thread implementation is &quot;interesting&quot; to say the
least. Experiments with <b>many</b> different types of IO processing simply
cannot make a dent in it. Future releases of <a
href="../Mongrel.html">Mongrel</a> will find other creative ways to make
threads faster, but don&#8217;t hold your breath until Ruby 1.9 is actually
finally useful.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000035">new</a>&nbsp;&nbsp;
      <a href="#M000036">process_client</a>&nbsp;&nbsp;
      <a href="#M000038">register</a>&nbsp;&nbsp;
      <a href="#M000037">run</a>&nbsp;&nbsp;
      <a href="#M000040">stop</a>&nbsp;&nbsp;
      <a href="#M000039">unregister</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">acceptor</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000035.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000035.html');return false;">
          <span class="method-name">new</span><span class="method-args">(host, port, num_processors=20, timeout=120)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a working server on host:port (strange things happen if port
isn&#8217;t a Number). Use HttpServer::run to start the server.
</p>
<p>
The num_processors variable has varying affects on how requests are
processed. You&#8216;d think adding more processing threads (processors)
would make the server faster, but that&#8217;s just not true. There&#8217;s
actually an effect of how Ruby does threads such that the more processors
waiting on the request queue, the slower the system is to handle each
request. But, the lower the number of processors the fewer concurrent
responses the server can make.
</p>
<p>
20 is the default number of processors and is based on experimentation on a
few systems. If you find that you overload <a
href="../Mongrel.html">Mongrel</a> too much try changing it higher. If you
find that responses are way too slow try lowering it (after you&#8217;ve
tuned your stuff of course).
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000036.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000036.html');return false;">
          <span class="method-name">process_client</span><span class="method-args">(client)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Does the majority of the IO processing. It has been written in Ruby using
about 7 different IO processing strategies and no matter how it&#8217;s
done the performance just does not improve. It is currently carefully
constructed to make sure that it gets the best possible performance, but
anyone who thinks they can make it faster is more than welcome to take a
crack at it.
</p>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000038.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000038.html');return false;">
          <span class="method-name">register</span><span class="method-args">(uri, handler)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Simply registers a handler with the internal <a
href="URIClassifier.html">URIClassifier</a>. When the URI is found in the
prefix of a request then your handler&#8217;s HttpHandler::process method
is called. See <a
href="URIClassifier.html#M000054">Mongrel::URIClassifier#register</a> for
more information.
</p>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000037.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000037.html');return false;">
          <span class="method-name">run</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Runs the thing. It returns the thread used so you can &quot;join&quot; it.
You can also access the HttpServer::acceptor attribute to get the thread
later.
</p>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000040.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000040.html');return false;">
          <span class="method-name">stop</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Stops the acceptor thread and then causes the worker threads to finish off
the request queue before finally exiting.
</p>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="HttpServer.src/M000039.html" target="Code" class="method-signature"
            onclick="popupCode('HttpServer.src/M000039.html');return false;">
          <span class="method-name">unregister</span><span class="method-args">(uri)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes any handler registered at the given URI. See <a
href="URIClassifier.html#M000055">Mongrel::URIClassifier#unregister</a> for
more information.
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>